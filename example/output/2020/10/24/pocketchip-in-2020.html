<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

	<title>David Díaz  | PocketChip in 2020 </title>

	<link rel="stylesheet" href="/css/screen.css">
	<link rel="alternate" type="application/rss+xml" title="RSS Feed for martianwabbit.com" href="https://martianwabbit.com/feed.xml" />
	<link rel="me" href="https://mastodon.social/@seich" />
</head>
<body>
<div id="top">
	<h1><a href="/">David Díaz<span>.</span></a></h1>
</div>

<header>
  <h1>
    <a href="">PocketChip in 2020</a>
  </h1>

  <aside>
    <time>Posted on: October 24, 2020</time>
    <span>878 Words</span>
    <span
      >Takes 5 minutes to read</span
    >
  </aside>
</header>
<article>
  <p>After many years of wanting one and then giving up on them when the company went
under, I finally acquired a PocketChip. This thing is great. Not all around
great but great <em>in principle</em>. It has a great form factor with a nice screen
and great battery life. I quite like it. I've been using it to control my
plotters wirelessly, for counting words on my typewriter and to backup my op-z.
I've ran into a bunch of issues along the way so here are my notes on it, what's
worked and what hasn't in case someone else wants to give it a go.</p>
<p><img src="/files/2020-10-24-pocketchip-in-2020/pocket-chip.jpg" alt="My PocketChip"></p>
<h2>Apt Sources</h2>
<p>The first thing you should do is change you apt sources. It turns out when the
NextThingCo went under they took their mirrors with them (naturally). Luckily a
valuable member of the community took the time to create a mirror for it we can
all use <a href="http://chip.jfpossibilities.com/chip/debian/">here</a>. That same member
of the community also took the time to mirror all of NextThingCo's repositories
and other goodies:
<a href="http://chip.jfpossibilities.com/">http://chip.jfpossibilities.com/</a> this is in
general the single best resource of data and code available for the chip in
2020.</p>
<p>I ran into an issue with Jessie backports, as the distribution is pretty old
it'll be necessary to update your apt sources to use the debian archive mirror:</p>
<pre><code class="language-sh">deb http://security.debian.org/ jessie/updates main
deb-src http://security.debian.org/ jessie/updates main

deb http://archive.debian.org/debian/ jessie-backports main
deb-src http://archive.debian.org/debian/ jessie-backports main

deb http://archive.debian.org/debian/ jessie main contrib non-free
deb-src http://archive.debian.org/debian/ jessie main contrib non-free
</code></pre>
<p>Don't forget to disable validity checks:</p>
<pre><code class="language-sh">echo "Acquire::Check-Valid-Until false;" | sudo tee -a /etc/apt/apt.conf.d/10-nocheckvalid
</code></pre>
<h2>SSH Access</h2>
<p>The PocketChip doesn't include an ssh server by default so I'd recommend
installing one once you've gotten your apt updating and running:</p>
<pre><code class="language-sh">sudo apt-get install openssh-server
</code></pre>
<h2>Checking the Battery Level</h2>
<p>There's two magic files in the os that reflect your current battery state, you
can use <code>/usr/lib/pocketchip-batt/voltage</code> to check how charged your PocketChip
is and you can use <code>/usr/lib/pocketchip-batt/charging</code> to check if it's charging
or not. These are mostly useful for scripts and such.</p>
<p>The voltage range is from <code>3600</code> to <code>4200</code> from what I've seen.</p>
<h2>Using UART</h2>
<p>If you want to use the built-in UART you need to shutdown getty:</p>
<pre><code class="language-sh">sudo systemctl stop serial-getty@ttyS0.service
</code></pre>
<p>You can then use <code>/dev/ttyS0</code> as you normally would as a terminal or programmer
and <code>stty</code> to check the config <code>stty -F /dev/ttyS0</code> or change it
<code>stty -F /dev/ttyUSB0 9600</code>.</p>
<h2>A full desktop environment</h2>
<p>If you want to have a full desktop environment running on your chip, you can use
<a href="https://github.com/AllGray/PocketDesk">PocketDesk</a>, which sets it up for you.</p>
<h2>Using your GPIO Pins</h2>
<p>This actually took a lot of tinkering and was going to be the original focus of
this blog post.</p>
<p>PocketOS provides an easy way (once you figure it out) to enable or disable gpio
pins. Under <code>/sys/class/gpio</code> there's two sinks <code>export</code> and <code>unexport</code>. As
<code>root</code> you can use <code>export</code> to enable a gpio pin by piping it the pin's
identifier:</p>
<pre><code class="language-sh">echo 1015 > /sys/class/gpio/export
</code></pre>
<p>Apparently these identifiers changed depending on the OS version, on mine it
starts with GPIO 1 as <code>1015</code> and follows with GPIO 2 on <code>1016</code> and so on. When
you are done using a pin you should <code>unexport</code> it:</p>
<pre><code class="language-sh">echo 1015 > /sys/class/gpio/unexport
</code></pre>
<p>While the pin is exported you can set three settings according to what you are
trying to achieve:</p>
<ol>
<li>Pin direction:</li>
</ol>
<pre><code class="language-sh">echo "in" > /sys/class/gpio/gpio1015/direction
echo "out" > /sys/class/gpio/gpio1015/direction
</code></pre>
<ol start="2">
<li>Active Low:</li>
</ol>
<pre><code class="language-sh">echo 1 > /sys/class/gpio/gpio1015/active_low
echo 0 > /sys/class/gpio/gpio1015/active_low
</code></pre>
<ol start="3">
<li>Edge detection:</li>
</ol>
<pre><code class="language-sh">echo "rising" > /sys/class/gpio/gpio1015/edge
echo "falling" > /sys/class/gpio/gpio1015/edge
echo "none" > /sys/class/gpio/gpio1015/edge
</code></pre>
<p>You can check the GPIO's state by reading the value:</p>
<pre><code class="language-sh">cat /sys/class/gpio/gpio1015/value
# Either 0 or 1 depending on the current state of the pin.
</code></pre>
<p>Since this behaves like a normal file and emits events you can use anything that
uses inotify to watch it. For example, here's how you'd monitor a button press
using inotify-hookable:</p>
<pre><code class="language-sh">cd /sys/class/gpio
echo 1015 > export
cd gpio1015

echo 0 > active_low
echo "in" > direction
echo "rising" > edge

inotify-hookable -f ./value -c "cat ./value"
</code></pre>
<p>There's some extra information about the pins in the
<a href="http://web.archive.org/web/20210222094348/http://www.chip-community.org/index.php/GPIO_Info">community wiki</a>.
The pin numbers seem wrong for the pocketchip but the rest of the information
available seems solid.</p>
<h2>Configure the app launcher</h2>
<p>The default built-in launcher for the PocketChip, PocketHome, can be minimally
configured by editing a json file <code>/usr/share/pocket-home/config.json</code>. You can
change the apps and the icons from there among other small niceties.</p>
<p>I'd recommend changing the terminal to xfce-terminal, it comes pre-installed and
seems to be better in general, I changed the terminal button to this:</p>
<pre><code class="language-json">{
  "name": "Terminal",
  "shell": "xfce-terminal --hide-borders --fullscreen --hide-menubar",
  "icon": "appIcons/terminal.png"
}
</code></pre>
<p>You need to restart the entire PocketChip for the changes to kick in.</p>
<p>Also, if you are ever using a keyboard, dmenu is installed and mapped to alt +
space which is super nice for quickly switching apps.</p>
<p>And that's it, I think, everything I've had to figure out about the PocketChip,
distilled into one blog post. Let me know if there's anything important you
think I should know.</p>

  <p class="comments">
    Have a comment? Feel free to
    <a href="mailto:seich@martianwabbit.com">email me</a>.<br />
    Did you enjoy this post?
    <a href="https://www.buymeacoffee.com/seich">Buy me a coffee ☕️</a>.
  </p>
</article>


<footer>
	<p>David Díaz © All Rights Reserved.</p>
</footer>
</body>
</html>
